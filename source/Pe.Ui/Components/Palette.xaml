<core:RevitHostedUserControl x:Class="PeUi.Components.Palette"
                             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                             xmlns:local="clr-namespace:PeUi.Components"
                             xmlns:core="clr-namespace:PeUi.Core"
                             VerticalAlignment="Top">
    <Grid HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch">
        <!-- Main container with sidebar support -->
        <Border x:Name="MainBorder"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="{ui:ThemeResource ApplicationBackgroundBrush}">
            <Grid HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition x:Name="SidebarColumn" Width="0" />
                </Grid.ColumnDefinitions>

                <!-- Main palette content -->
                <Grid Grid.Column="0"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Search Box with Filter -->
                    <Border x:Name="SearchBoxBorder"
                            ClipToBounds="True"
                            Background="{ui:ThemeResource ApplicationBackgroundBrush}">
                        <Grid x:Name="SearchBoxGrid"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ui:TextBox x:Name="SearchTextBox"
                                        Grid.Column="0"
                                        Style="{StaticResource TransparentTextBoxStyle}"
                                        Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <ui:TextBox.InputBindings>
                                    <KeyBinding Key="Down" Command="{Binding MoveSelectionDownCommand}" />
                                    <KeyBinding Key="Up" Command="{Binding MoveSelectionUpCommand}" />
                                </ui:TextBox.InputBindings>
                            </ui:TextBox>

                            <!-- FilterBox will be added programmatically to Grid.Column="1" -->
                        </Grid>
                    </Border>

                    <!-- Item List -->
                    <Border Grid.Row="1" Padding="4,0,4,0">
                        <local:ListView x:Name="ItemListView"
                                        ItemsSource="{Binding FilteredItems}"
                                        SelectedItem="{Binding SelectedItem}"
                                        SelectedIndex="{Binding SelectedIndex}" />
                    </Border>

                    <!-- Status Bar -->
                    <Border x:Name="StatusBarBorder"
                            Grid.Row="2"
                            Background="{ui:ThemeResource CardBackgroundFillColorSecondaryBrush}">
                        <Grid x:Name="StatusBarGrid">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <ui:TextBlock x:Name="ItemCountText"
                                          Grid.Column="0"
                                          Text="{Binding FilteredItems.Count, StringFormat=\{0\} items}"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"
                                          Style="{DynamicResource CaptionTextBlockStyle}"
                                          Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" />

                            <ui:TextBlock x:Name="HelpText"
                                          Grid.Column="1"
                                          Text="↑↓ Navigate • ← Tooltip • → Actions • Click/Enter Execute • Esc Close"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Right"
                                          Style="{DynamicResource CaptionTextBlockStyle}"
                                          Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" />
                        </Grid>
                    </Border>
                </Grid>

                <!-- Sidebar container (initially collapsed) -->
                <Border x:Name="SidebarBorder"
                        Grid.Column="1"
                        Background="{ui:ThemeResource ApplicationBackgroundBrush}"
                        BorderThickness="1,0,0,0"
                        BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}">
                    <ContentControl x:Name="SidebarContent" />
                </Border>
            </Grid>
        </Border>
    </Grid>
</core:RevitHostedUserControl>