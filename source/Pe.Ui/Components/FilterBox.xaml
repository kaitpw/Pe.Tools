<core:RevitHostedUserControl x:Class="Pe.Ui.Components.FilterBox"
                             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                             xmlns:local="clr-namespace:Pe.Ui.Components"
                             xmlns:core="clr-namespace:Pe.Ui.Core"
                             xmlns:converters="clr-namespace:Pe.Ui.Core.Converters"
                             x:Name="Root">
    <UserControl.Resources>
        <converters:VisibilityConverter x:Key="VisibilityConverter" />
    </UserControl.Resources>

    <Border x:Name="FilterBorder"
            ClipToBounds="False"
            Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
            CornerRadius="4">
        <Grid VerticalAlignment="Center">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Filter Pill Badge (shows selected filter value) -->
            <local:Pill x:Name="FilterPill"
                        Grid.Column="0"
                        Margin="4,4,0,4"
                        Background="{ui:ThemeResource CardBackgroundFillColorSecondaryBrush}"
                        Text="{Binding SelectedFilterValue, Mode=OneWay}"
                        Visibility="{Binding SelectedFilterValue, Mode=OneWay, Converter={StaticResource VisibilityConverter}}" />

            <!-- Clear Filter Button (X icon, visible only when filter is active) -->
            <Border x:Name="ClearFilterBorder"
                    Grid.Column="1"
                    Width="16"
                    Height="16"
                    Background="Transparent"
                    Cursor="Hand"
                    VerticalAlignment="Center"
                    Margin="4,4,0,4"
                    Visibility="{Binding SelectedFilterValue, Mode=OneWay, Converter={StaticResource VisibilityConverter}}"
                    MouseLeftButtonDown="ClearFilterBorder_MouseLeftButtonDown">
                <ui:SymbolIcon x:Name="ClearFilterIcon"
                               Symbol="Dismiss24"
                               Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center" />
            </Border>

            <!-- Filter Icon Button (always visible, smaller size) -->
            <Border x:Name="IconBorder"
                    Grid.Column="2"
                    Width="16"
                    Height="16"
                    Margin="4,4,4,4"
                    Background="Transparent"
                    Cursor="Hand"
                    VerticalAlignment="Center"
                    MouseLeftButtonDown="IconBorder_MouseLeftButtonDown">
                <ui:SymbolIcon x:Name="FilterIcon"
                               Symbol="Filter24"
                               Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center" />
            </Border>

            <!-- Expandable AutoSuggestBox (collapsed by default) -->
            <local:AutoSuggestBox x:Name="FilterAutoSuggestBox"
                                  Grid.Column="3"
                                  Width="0"
                                  Opacity="0"
                                  VerticalAlignment="Center"
                                  PlaceholderText="Filter..."
                                  TextBoxStyle="{StaticResource TransparentTextBoxStyle}"
                                  MaxSuggestionListHeight="300"
                                  ItemsSource="{Binding AvailableFilterValues, Mode=OneWay}"
                                  GotFocus="FilterAutoSuggestBox_GotFocus"
                                  LostFocus="FilterAutoSuggestBox_LostFocus" />
        </Grid>
    </Border>
</core:RevitHostedUserControl>